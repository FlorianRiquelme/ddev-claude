name: ddev-claude
ddev_version_constraint: '>= v1.24.10'

# Architecture: Dedicated claude container with firewalled network
# Web container remains unchanged

pre_install_actions:
  - |
    #ddev-description:Validating Docker supports NET_ADMIN capability
    docker run --rm --cap-add=NET_ADMIN alpine sh -c 'exit 0' || (echo "ERROR: Docker does not support NET_ADMIN capability. This addon requires NET_ADMIN for iptables firewall management." && exit 1)
  - |
    #ddev-description:Cleaning up previous addon files for upgrade
    rm -rf .ddev/claude .ddev/commands/host/claude .ddev/commands/host/claude-whitelist

project_files:
  - claude/
  - docker-compose.claude.yaml
  - commands/host/

post_install_actions:
  - |
    #ddev-description:Copying Claude skills to project
    mkdir -p .ddev/ddev-claude/skills
    cp -r .ddev/claude/skills/* .ddev/ddev-claude/skills/ 2>/dev/null || true
  - |
    #ddev-description:Making firewall scripts executable
    chmod +x .ddev/claude/*.sh 2>/dev/null || true

removal_actions:
  - |
    #ddev-description:Removing addon files
    rm -rf .ddev/claude .ddev/docker-compose.claude.yaml
