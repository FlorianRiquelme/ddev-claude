#ddev-generated
services:
  claude:
    build:
      context: claude
      dockerfile: Dockerfile.claude
    container_name: ddev-${DDEV_SITENAME}-claude

    cap_add:
      - NET_ADMIN
      - NET_RAW

    entrypoint: ["${DDEV_APPROOT}/.ddev/claude/entrypoint.sh"]
    command: ["tail", "-f", "/dev/null"]

    volumes:
      - type: bind
        source: ${DDEV_APPROOT}
        target: ${DDEV_APPROOT}
        consistency: cached
      - ~/.claude:/root/.claude:rw
      - ~/.claude.json:/root/.claude.json:rw

    working_dir: ${DDEV_APPROOT}

    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - DDEV_APPROOT=${DDEV_APPROOT}

    networks:
      - default

    healthcheck:
      test: ["CMD-SHELL", "${DDEV_APPROOT}/.ddev/claude/healthcheck.sh"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 15s

    labels:
      com.ddev.site-name: ${DDEV_SITENAME}
      com.ddev.approot: ${DDEV_APPROOT}

networks:
  default:
    name: ddev_default
    external: true
